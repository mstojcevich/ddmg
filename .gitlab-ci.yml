image: dlang2/ldc-ubuntu

variables:
  GIT_SUBMODULE_STRATEGY: recursive
  
build:linux:
  stage: build
  script: ci/build-release.sh
  artifacts:
    paths:
      - ddmg
    expire_in: 1 week
        
unittests:
  stage: test
  script: ci/unittests.sh
          
blargg-cpu_instrs:
  stage: test
  dependencies:
    - build:linux
  script: ./ddmg --rom "./test-roms/blargg/cpu_instrs/cpu_instrs.gb" --testMode "blargg" --testMaxInstrs 25000000

blargg-instr_timing:
  stage: test
  dependencies:
    - build:linux
  script: ./ddmg --rom "./test-roms/blargg/instr_timing/instr_timing.gb" --testMode "blargg" --testMaxInstrs 300000

blargg-mem_timing:
  stage: test
  dependencies:
    - build:linux
  script: ./ddmg --rom "./test-roms/blargg/mem_timing/mem_timing.gb" --testMode "blargg" --testMaxInstrs 700000
